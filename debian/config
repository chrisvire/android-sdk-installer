#!/bin/sh

set -e


. /usr/share/debconf/confmodule

while true; do
    db_input medium android-sdk-installer/dldir || true
    db_go
    db_get android-sdk-installer/dldir
    if [ -n "$RET" ] && [ -d "$RET" ];then
        BADFILE=0
        for file in $RET/*.zip;do
            unzip -qqt "$file" || BADFILE=1
            case "$(basename "$file")" in
                tools_*) tools=$file ;;
                android-*) platform=$file ;;
                platform-tools_*) platform_tools=$file ;;
                build-tools_*) build_tools=$file ;;
            esac
        done
        if [ ! $BADFILE ] && [ -n "$tools" ] && [ -n "$platform" ] && [ -n "$platform_tools" ] && [ -n "$build_tools" ];then
            break
        fi
    elif [ -z "$RET" ];then
        break
    fi
    db_reset android-sdk-installer/baddldir || true
    db_reset android-sdk-installer/dldir || true
    db_input medium android-sdk-installer/baddldir || true
    db_go
done
