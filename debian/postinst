#!/bin/sh
set -e

. /usr/share/debconf/confmodule

db_get android-sdk-installer/dldir
LOCALCOPY=$RET

stamp_file=/var/lib/update-notifier/package-data-downloads/android-sdk-installer

# if the license was not accepted, ensure the sdk is removed
# and add README with helpful information
SDKDIR=/opt/android-sdk
license=android-sdk-eula
db_get android-sdk-installer/accepted-$license
if [ "$RET" != "true" ]; then
  echo "user did not accept the $license license" >&2
  mkdir -pm777 $SDKDIR -m 777
  rm -rf $SDKDIR/*
  cat > $SDKDIR/README <<EOF
License refused.

Please reinstall the android-sdk-installer package (e.g. via
 apt-get install --reinstall android-sdk-installer
to get prompted for the license again.
EOF
     exit 0
else
    rm -f $SDKDIR/README
fi

if ! [ -e $stamp_file ] && [ -n "$LOCALCOPY" ]; then
	/usr/lib/android-sdk-installer/install-android-sdk \
	   "$LOCALCOPY"/tools* "$LOCALCOPY"/android* \
           "$LOCALCOPY"/platform-tools* "$LOCALCOPY"/build-tools*
	touch $stamp_file
fi

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
