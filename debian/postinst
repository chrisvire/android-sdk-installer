#!/bin/sh
set -e

. /usr/share/debconf/confmodule

db_get android-sdk-installer/dldir
LOCALCOPY=$RET

# FIXME: we don't have a way to use an alternate download source here.
db_get android-sdk-installer/dlurl
URLOVERRIDE=$RET

stamp_file=/var/lib/update-notifier/package-data-downloads/android-sdk-installer

if dpkg --compare-versions "$2" lt-nl 3.4ubuntu3 \
   && [ -f /var/lib/android-sdk-installer/archives ]
then
	# don't force a redownload with the new hook
	touch $stamp_file
fi

# if the license was not accepted, ensure the fonts are removed
# and add README with helpful information
SDKDIR=/opt/android-sdk
mkdir -p $SDKDIR
license=android-sdk-eula
db_get android-sdk-installer/accepted-$license
if [ "$RET" != "true" ]; then
  echo "user did not accept the $license license" >&2
  rm -rf $SDKDIR/*
  cat > $SDKDIR/README <<EOF
License refused.

Please reinstall the android-sdk-installer package (e.g. via
 apt-get install --reinstall android-sdk-installer
to get prompted for the license again.
EOF
     exit 0
else
    rm -f $SDKDIR/README
fi

if ! [ -e $stamp_file ] && [ -n "$LOCALCOPY" ]; then
	/usr/lib/android-sdk-installer/update-android-sdk "$LOCALCOPY"/*
	touch $stamp_file
fi

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
