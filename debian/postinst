#!/bin/sh
set -e

. /usr/share/debconf/confmodule

db_get android-sdk-installer/dldir
LOCALCOPY=$RET

# if the license was not accepted, ensure the sdk is removed
# and add README with helpful information
SDKDIR=/opt/android-sdk
license=android-sdk-eula
db_get android-sdk-installer/accepted-$license
if [ "$RET" != "true" ]; then
  echo "user did not accept the $license license" >&2
  mkdir -pm777 $SDKDIR -m 777
  rm -rf $SDKDIR/*
  cat > $SDKDIR/README <<EOF
License refused.

Please reinstall the android-sdk-installer package (e.g. via
 apt-get install --reinstall android-sdk-installer
to get prompted for the license again.
EOF
     exit 0
else
    rm -f $SDKDIR/README
fi


URLSFILE=/usr/lib/android-sdk-installer/android-sdk-urls.md
FILES=$(grep -o '[^/]*$' "$URLSFILE")

DELETE=false
if [ -z "$LOCALCOPY" ]; then
    mkdir -pm777 "$SDKDIR"
    cd "$SDKDIR"
    wget -ci "$URLSFILE"
    LOCALCOPY=$SDKDIR
    DELETE=true
fi

cd "$LOCALCOPY"
/usr/lib/android-sdk-installer/install-android-sdk $FILES

if $DELETE; then
    rm $FILES
fi

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
